---
description: Checklist - Debugging & Troubleshooting globs:
globs: 
alwaysApply: false
---
---
# ğŸ› MMM Checklist - Debugging & Troubleshooting

## ğŸš¨ Common Production Errors & Solutions (2025-02-06)

### CORS Error
```javascript
// âŒ Problem: Access to fetch at 'http://localhost:5000/api/...' from origin 'http://localhost:3000' has been blocked by CORS policy

// âœ… Solution 1: server.js'de CORS middleware doÄŸru sÄ±rada olmalÄ±
app.use(cors({
  origin: ['http://localhost:3000', 'http://localhost:3001'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// âœ… Solution 2: OPTIONS request handler (CORS middleware'den Ã¶nce)
app.options('*', cors());
```

### 431 Request Header Fields Too Large
```javascript
// âŒ Problem: Server Error 431 - Request header too large

// âœ… Solution: server.js'de header size limitlerini artÄ±r
const server = app.listen(PORT, '0.0.0.0', () => {
  console.log(`Server running on port ${PORT}`);
});

// Header size limitlerini artÄ±r
server.maxHeaderSize = 32768; // 32KB
server.headersTimeout = 60000; // 60 saniye
server.keepAliveTimeout = 65000; // 65 saniye
```

### DOM Validation Warning
```javascript
// âŒ Problem: Warning: validateDOMNesting(...): <div> cannot appear as a descendant of <p>

// âœ… Solution: Material-UI Box component kullan
// HatalÄ±:
<p><div>Ä°Ã§erik</div></p>

// DoÄŸru:
<Box><Box>Ä°Ã§erik</Box></Box>
```

### PropTypes Validation Errors
```javascript
// âŒ Problem: Failed prop type: The prop `items[11].sorumluKisi.ad` is marked as required in `InventoryTable`, but its value is `undefined`

// âœ… Solution 1: PropTypes tanÄ±mÄ±nÄ± dÃ¼zelt
// HatalÄ±:
sorumluKisi: PropTypes.shape({
  ad: PropTypes.string.isRequired,
  soyad: PropTypes.string.isRequired,
})

// DoÄŸru:
sorumluKisi: PropTypes.shape({
  ad: PropTypes.string,
  soyad: PropTypes.string,
})

// âœ… Solution 2: Backend populate dÃ¼zeltmesi
// Model field'larÄ± kontrol et ve doÄŸru populate yap:
.populate('sorumluKisi', 'ad soyad username') // User modelindeki doÄŸru field'lar

// âœ… Solution 3: Frontend-Backend uyumsuzluÄŸu
// Frontend bekliyor: pagination.totalItems
// Backend gÃ¶nderiyor: pagination.total
// Backend response'u dÃ¼zelt:
pagination: {
  currentPage: page,
  totalPages: Math.ceil(total / limit),
  totalItems: total, // 'total' yerine 'totalItems'
}

// âœ… Solution 4: Component'e default props ekle
ComponentName.defaultProps = {
  items: [],
  pagination: { totalItems: 0 },
  selectedItems: [],
};
```

### Type Coercion PropTypes Errors
```javascript
// âŒ Problem: Invalid prop `isFormValid` of type `string` supplied to `Component`, expected `boolean`

// âœ… Solution 1: Logical AND hatasÄ± - ilk truthy deÄŸeri dÃ¶ndÃ¼rÃ¼r
// HatalÄ±:
const isFormValid = () => {
  return formData.ad.trim() && formData.rol && items.length > 0;
};
// formData.ad.trim() = "text" dÃ¶ndÃ¼rÃ¼rse, logical AND "text" dÃ¶ndÃ¼rÃ¼r

// DoÄŸru - Double negation:
const isFormValid = () => {
  return !!(formData.ad.trim() && formData.rol && items.length > 0);
};

// âœ… Solution 2: Boolean constructor kullan
const isFormValid = () => {
  return Boolean(formData.ad.trim() && formData.rol && items.length > 0);
};

// âœ… Solution 3: Ternary operator
const isFormValid = () => {
  return formData.ad.trim() && formData.rol && items.length > 0 ? true : false;
};

// âœ… Solution 4: Hook/Component'te kullanÄ±rken type conversion
// Hook'ta:
return {
  isFormValid: isFormValid(), // fonksiyonu Ã§aÄŸÄ±rmayÄ± unutma
  // veya
  isFormValid: !!someValue,
};

// Component'te:
<Component 
  isFormValid={!!stringValue}
  // veya
  isFormValid={Boolean(stringValue)}
/>
```

### React Key Prop & Material-UI Select Errors
```javascript
// âŒ Problem: Each child in a list should have a unique "key" prop
// âŒ Problem: Cannot read properties of undefined (reading '_id')

// âœ… Solution 1: Material-UI Multi-Select value handling
// HatalÄ±:
<Select
  multiple
  value={selectedItems} // Object array
  onChange={(e) => setSelectedItems(e.target.value)} // Crash! e.target.value is string[]
>
  renderValue={(selected) => (
    {selected.map((item) => ( // item is string, not object!
      <Chip label={item.name} /> // Undefined error!
    ))}
  )}

// DoÄŸru:
<Select
  multiple
  value={selectedItems.map(item => item._id)} // ID array
  onChange={(e) => {
    const ids = e.target.value;
    const objects = ids.map(id => 
      allItems.find(item => item._id === id)
    ).filter(Boolean);
    setSelectedItems(objects);
  }}
  renderValue={(selected) => ( // selected is ID array
    {selected.map((id) => {
      const item = allItems.find(i => i._id === id);
      return item ? (
        <Chip key={id} label={item.name} />
      ) : null;
    })}
  )}
>

// âœ… Solution 2: Always add key prop to mapped elements
// HatalÄ±:
{items.map(item => <Chip label={item.name} />)}

// DoÄŸru:
{items.map(item => <Chip key={item._id} label={item.name} />)}

// âœ… Solution 3: Defensive programming with null checks
// HatalÄ±:
const machine = machines.find(m => m._id === id);
return <Chip label={machine.name} />; // Crash if machine is undefined

// DoÄŸru:
const machine = machines.find(m => m._id === id);
return machine ? <Chip key={machine._id} label={machine.name} /> : null;

// âœ… Solution 4: Empty array fallback
tempSelectedMachines.map(m => m._id) // Crash if tempSelectedMachines is undefined

// DoÄŸru:
(tempSelectedMachines || []).map(m => m?._id).filter(Boolean)
```

### Browser Cache & Hot Reload Issues
```javascript
// âŒ Problem: Kod deÄŸiÅŸiklikleri browser'da gÃ¶rÃ¼nmÃ¼yor, eski hatalar devam ediyor

// âœ… Solution 1: Hard Refresh (Windows)
// Ctrl + Shift + R veya Ctrl + F5

// âœ… Solution 2: Developer Tools'dan cache temizleme
// 1. F12 ile Developer Tools aÃ§
// 2. Network tab'Ä±na git
// 3. "Disable cache" checkbox'Ä±nÄ± iÅŸaretle
// 4. SayfayÄ± yenile

// âœ… Solution 3: React development server'Ä± restart et
// Terminal'de:
// Ctrl + C (durdurmak iÃ§in)
// npm start (yeniden baÅŸlatmak iÃ§in)

// âœ… Solution 4: Browser cache'i tamamen temizle
// Chrome: Settings â†’ Privacy â†’ Clear browsing data â†’ Cached images and files

// âœ… Solution 5: .env dosyasÄ±na ekleme (development iÃ§in)
// FAST_REFRESH=false

// âœ… Solution 6: Webpack dev server cache'i temizle
rm -rf node_modules/.cache
npm start

// âœ… Solution 7: Port deÄŸiÅŸtirerek baÅŸlat
PORT=3001 npm start

// Common cache-related errors:
// - "setSelectedMachines is not a function" â†’ Eski kod cached
// - Line numbers don't match â†’ Source map cache issue
// - Changes not reflected â†’ Hot reload failure
```

## Port Ã‡akÄ±ÅŸmasÄ± & Cache SorunlarÄ±

### Backend Port DeÄŸiÅŸtirme & Cache Temizleme
```javascript
// server.js
const PORT = process.env.PORT || 5001; // 5000 yerine 5001 kullan

// frontend/package.json
"proxy": "http://localhost:5001"
```

### Port Ã‡akÄ±ÅŸmasÄ± KontrolÃ¼
```bash
# Windows'ta port kontrolÃ¼
netstat -ano | findstr :5000
tasklist /FI "PID eq 5000" /FO TABLE

# Port'u serbest bÄ±rakma
taskkill /PID [PID_NUMBER] /F

# Nodemon cache temizleme
rm -rf node_modules/.cache
npx nodemon --clean
```

### Nodemon Cache SorunlarÄ±
```bash
# Nodemon restart'Ä± zorla
rs  # Nodemon console'da

# Cache temizleme
rm -rf backend/node_modules/.cache
rm -rf backend/.nodemonignore.cache

# Environment variable override kontrolÃ¼
echo $PORT  # Linux/Mac
echo %PORT%  # Windows

# .env dosyasÄ± kontrol et
cat backend/.env | grep PORT
```

### Environment Variable Priority
```bash
# Ã–ncelik sÄ±rasÄ±:
# 1. System environment variables
# 2. .env dosyasÄ±
# 3. Default value (kod iÃ§inde)

# .env dosyasÄ±nÄ± override etme
PORT=5001 npm run start:backend
```

## Browser Compatibility & Polyfills

### Process Polyfill (Zorunlu)
```html
<!-- public/index.html iÃ§ine ekle -->
<script>
  window.process = window.process || { 
    env: { 
      NODE_ENV: 'development',
      REACT_APP_VERSION: '1.0.0'
    } 
  };
</script>
```

### Node.js Core Modules Polyfills
```javascript
// webpack.config.js fallback (React Scripts v5+)
module.exports = {
  resolve: {
    fallback: {
      "process": require.resolve("process/browser"),
      "buffer": require.resolve("buffer"),
      "crypto": require.resolve("crypto-browserify"),
      "stream": require.resolve("stream-browserify"),
      "util": require.resolve("util/"),
      "url": require.resolve("url/"),
      "assert": require.resolve("assert/"),
    }
  },
  plugins: [
    new webpack.ProvidePlugin({
      process: 'process/browser',
      Buffer: ['buffer', 'Buffer'],
    }),
  ],
};
```

### Browser-Specific Fixes
```javascript
// IE11 desteÄŸi (gerekirse)
import 'core-js/stable';
import 'regenerator-runtime/runtime';

// Safari date parsing fix
const parseDate = (dateString) => {
  // Safari ISO date parsing sorunu
  return new Date(dateString.replace(/-/g, '/'));
};

// Chrome memory leak prevention
const clearIntervals = () => {
  const highestTimeoutId = setTimeout(() => {}, 0);
  for (let i = 0; i < highestTimeoutId; i++) {
    clearTimeout(i);
  }
};
```

### Mobile Browser Compatibility
```javascript
// iOS Safari viewport fix
const fixIOSViewport = () => {
  const viewport = document.querySelector('meta[name="viewport"]');
  if (viewport && /iPad|iPhone|iPod/.test(navigator.userAgent)) {
    viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
  }
};

// Touch event polyfill
const addTouchSupport = () => {
  if (!('ontouchstart' in window)) {
    // Mouse events'i touch events'e Ã§evir
    document.addEventListener('mousedown', (e) => {
      e.target.dispatchEvent(new TouchEvent('touchstart', {
        touches: [{ clientX: e.clientX, clientY: e.clientY }]
      }));
    });
  }
};
```

## React Router Future Flags

### v7 HazÄ±rlÄ±ÄŸÄ±
```javascript
// App.js
<BrowserRouter
  future={{
    v7_startTransition: true,
    v7_relativeSplatPath: true,
  }}
>
```

## ESLint Auto-Fix Workflows & Common Patterns

### Automated Fix Commands
```bash
# Tam proje ESLint fix
npx eslint src/ --fix --ext .js,.jsx,.ts,.tsx

# Belirli dosya pattern'larÄ±
npx eslint "src/**/*.{js,jsx}" --fix
npx eslint src/pages/ --fix --max-warnings 0

# Cache ile hÄ±zlÄ± fix
npx eslint src/ --fix --cache --cache-location .eslintcache

# Sadece belirli kurallarÄ± fix et
npx eslint src/ --fix --rule "comma-dangle: error"
```

### ESLint Rule Categories & Fixes

#### ğŸ¯ Syntax & Formatting
```javascript
// âŒ Missing trailing comma
const obj = { a: 1, b: 2 };
const arr = [1, 2, 3];

// âœ… Correct (auto-fixable)
const obj = { a: 1, b: 2, };
const arr = [1, 2, 3, ];

// âŒ Semicolon missing/extra
const name = "value"
const name2 = "value";;

// âœ… Correct
const name = "value";
const name2 = "value";

// âŒ Quotes inconsistency
const str1 = "hello";
const str2 = 'world';

// âœ… Correct (double quotes preferred)
const str1 = "hello";
const str2 = "world";
```

#### ğŸ¯ React Hooks Dependencies
```javascript
// âŒ Missing dependencies
useEffect(() => {
  loadData(userId);
  updateStatus();
}, []); // userId, loadData, updateStatus eksik

// âœ… Correct
useEffect(() => {
  loadData(userId);
  updateStatus();
}, [userId, loadData, updateStatus]);

// âŒ Unnecessary dependencies
useEffect(() => {
  setCount(0);
}, [count]); // count dependency gereksiz

// âœ… Correct
useEffect(() => {
  setCount(0);
}, []);
```

#### ğŸ¯ Variable Declarations
```javascript
// âŒ var usage
var name = "value";
var items = [];

// âœ… Correct
const name = "value";
const items = [];

// âŒ Unused variables
const unusedVar = "value";
const { usedProp, unusedProp } = props;

// âœ… Correct
const { usedProp, unusedProp: _unusedProp } = props;
// veya sadece kullanÄ±lanlarÄ± al
const { usedProp } = props;
```

#### ğŸ¯ Import/Export Organization
```javascript
// âŒ Unorganized imports
import Component from './Component';
import React, { useState } from 'react';
import { Button } from '@mui/material';
import axios from 'axios';

// âœ… Correct (auto-sortable)
import React, { useState } from 'react';
import axios from 'axios';
import { Button } from '@mui/material';
import Component from './Component';

// âŒ Unused imports
import React, { useState, useEffect } from 'react';
// useEffect kullanÄ±lmÄ±yor

// âœ… Correct
import React, { useState } from 'react';
```

### Custom ESLint Rules for MMM Project
```json
// .eslintrc.js custom rules
{
  "rules": {
    // Zorunlu kurallar
    "comma-dangle": ["error", "always-multiline"],
    "no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "react-hooks/exhaustive-deps": "error",
    
    // MMM specific rules
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error",
    "no-var": "error",
    
    // Performance rules
    "import/no-anonymous-default-export": "error",
    "react/jsx-key": "error"
  }
}
```

### Batch Fixing Strategies
```bash
# Fix belirli hata tiplerini
npx eslint src/ --fix --rule "comma-dangle: error, no-unused-vars: error"

# Sadece auto-fixable kurallarÄ± Ã§alÄ±ÅŸtÄ±r
npx eslint src/ --fix-dry-run  # Ã–nce test et
npx eslint src/ --fix          # Sonra uygula

# Git hook ile otomatik fix
# .husky/pre-commit
npx eslint --fix "src/**/*.{js,jsx}" && git add .
```

### VSCode Integration
```json
// .vscode/settings.json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "eslint.autoFixOnSave": true,
  "eslint.run": "onSave",
  "eslint.format.enable": true
}
```

### Common Error Patterns & Quick Fixes
```javascript
// âŒ Promise not awaited
const fetchData = () => {
  api.getData(); // Promise return edilmiyor
};

// âœ… Correct
const fetchData = async () => {
  return await api.getData();
};

// âŒ Missing key prop
items.map(item => <div>{item.name}</div>);

// âœ… Correct
items.map(item => <div key={item.id}>{item.name}</div>);

// âŒ Inline object in JSX (performance issue)
<Component style={{ marginTop: 10 }} />

// âœ… Correct
const componentStyle = { marginTop: 10 };
<Component style={componentStyle} />
```

## Node.js Deprecation Warnings

### util._extend UyarÄ±sÄ±
```javascript
// âŒ Deprecated
const util = require('util');
const extended = util._extend(target, source);

// âœ… Modern
const extended = Object.assign(target, source);
```

### Legacy OpenSSL Provider
```json
// package.json scripts
{
  "start": "set NODE_OPTIONS=--openssl-legacy-provider && react-scripts start",
  "build": "set NODE_OPTIONS=--openssl-legacy-provider && react-scripts build"
}
```

## Development vs Production Environment

### Environment Detection & Configuration
```javascript
// Environment detection
const isDevelopment = process.env.NODE_ENV === 'development';
const isProduction = process.env.NODE_ENV === 'production';
const isTest = process.env.NODE_ENV === 'test';

// Configuration based on environment
const config = {
  development: {
    apiUrl: 'http://localhost:5001',
    debug: true,
    logLevel: 'debug',
    hotReload: true,
    sourceMaps: true,
  },
  production: {
    apiUrl: process.env.REACT_APP_API_URL || 'https://api.example.com',
    debug: false,
    logLevel: 'error',
    hotReload: false,
    sourceMaps: false,
  }
};
```

### Development-Only Features
```javascript
// Development-only middleware
if (process.env.NODE_ENV === 'development') {
  // Hot reload enabler
  app.use(require('webpack-hot-middleware')(compiler));
  
  // Development error handler
  app.use((err, req, res, next) => {
    res.status(err.status || 500).json({
      message: err.message,
      stack: err.stack, // Stack trace sadece development'ta
      error: err
    });
  });
  
  // Development logging
  const morgan = require('morgan');
  app.use(morgan('dev'));
}
```

### Production Optimizations
```javascript
// Production-only settings
if (process.env.NODE_ENV === 'production') {
  // Compression middleware
  const compression = require('compression');
  app.use(compression());
  
  // Security headers
  app.use(helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        scriptSrc: ["'self'"],
        imgSrc: ["'self'", "data:", "https:"],
      },
    },
  }));
  
  // Production error handler (sanitized)
  app.use((err, req, res, next) => {
    res.status(err.status || 500).json({
      message: 'Bir hata oluÅŸtu',
      // Stack trace ve detaylar production'da gizli
    });
  });
}
```

### Environment Variables Management
```bash
# .env.development (sadece development)
NODE_ENV=development
PORT=5001
DEBUG=app:*
MONGODB_URI=mongodb://localhost:27017/mmm-checklist-dev
SEED_DATA=true

# .env.production (sadece production)
NODE_ENV=production
PORT=80
MONGODB_URI=mongodb://cluster.mongodb.net/mmm-checklist
SEED_DATA=false
LOG_LEVEL=error

# .env.local (git ignore'da, local overrides)
DATABASE_URL=postgresql://localhost:5432/local_db
API_KEY=local-development-key
```

### Build & Bundle Differences
```javascript
// webpack.config.js
module.exports = (env, argv) => {
  const isDevelopment = argv.mode === 'development';
  
  return {
    mode: isDevelopment ? 'development' : 'production',
    devtool: isDevelopment ? 'eval-source-map' : 'source-map',
    
    optimization: {
      minimize: !isDevelopment,
      splitChunks: isDevelopment ? false : {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: 'vendors',
            chunks: 'all',
          },
        },
      },
    },
    
    plugins: [
      ...(isDevelopment ? [
        new webpack.HotModuleReplacementPlugin(),
      ] : [
        new MiniCssExtractPlugin({
          filename: '[name].[contenthash].css',
        }),
      ]),
    ],
  };
};
```

### Development Port Configuration
```bash
# Port hierarchy
# Backend: 5001 (development), 80/443 (production)
# Frontend: 3000 (development), served by backend (production)
# MongoDB: 27017 (local), cluster (production)
# Redis: 6379 (local), cluster (production)

# Development proxy setup
"proxy": "http://localhost:5001"

# Production reverse proxy (nginx)
location /api {
  proxy_pass http://localhost:5001;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
}
```

### Debug Mode Management
```javascript
// Backend debug logger
const debug = require('debug')('app');
const isDev = process.env.NODE_ENV === 'development';

// Conditional debugging
if (isDev) {
  debug('Development mode - verbose logging enabled');
  console.log('All API requests will be logged');
}

// Frontend debug mode
const isDebugMode = process.env.NODE_ENV === 'development' || 
                   localStorage.getItem('debug') === 'true';

if (isDebugMode) {
  window.debugMode = true;
  console.log('Debug mode enabled - performance metrics visible');
}
```

## API Connection Debugging

### Network Errors
```javascript
// API service error handling
const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5001',
  timeout: 10000,
});

api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.code === 'ECONNREFUSED') {
      console.error('Backend baÄŸlantÄ±sÄ± kurulamÄ±yor. Port 5001 Ã§alÄ±ÅŸÄ±yor mu?');
    }
    return Promise.reject(error);
  }
);
```

## Memory & Performance Debugging

### Bundle Size Analysis
```bash
# Bundle analizi
npm run build:analyze
npx webpack-bundle-analyzer build/static/js/*.js

# Source map explorer
npm run analyze:size
```

### Memory Leaks
```javascript
// useEffect cleanup
useEffect(() => {
  const timer = setInterval(() => {
    // ...
  }, 1000);

  return () => clearInterval(timer); // Cleanup zorunlu
}, []);
```

## Database Connection Issues

### MongoDB BaÄŸlantÄ± HatalarÄ±
```javascript
// backend/config/db.js
const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGODB_URI, {
      maxPoolSize: 10,
      serverSelectionTimeoutMS: 5000,
      socketTimeoutMS: 45000,
    });
    console.log('âœ… MongoDB baÄŸlandÄ±');
  } catch (error) {
    console.error('âŒ MongoDB baÄŸlantÄ± hatasÄ±:', error.message);
    process.exit(1);
  }
};
```

## HTTP Header Size Issues

### 431 Request Header Fields Too Large
```javascript
// server.js
const server = require('http').createServer(app);
server.maxHeadersCount = 0; // Unlimited headers
server.headersTimeout = 60000; // 60 saniye
server.requestTimeout = 120000; // 2 dakika

// Process baÅŸlangÄ±cÄ±nda
process.env.NODE_OPTIONS = '--max-http-header-size=32768';
```

## Quick Fix Commands

### Development Reset
```bash
# TÃ¼m cache'leri temizle
npm run lint:cache-clear
rm -rf node_modules package-lock.json
npm install

# Port'larÄ± kontrol et
netstat -ano | findstr :3000
netstat -ano | findstr :5001
```

### Emergency Debugging
```bash
# ESLint problems
npm run lint:fix

# Bundle problems  
npm run build:analyze

# Port conflicts
npm run start:backend:different-port
npm run start:frontend:different-port
```

## Production Debugging

### Build Errors
```bash
# Production build test
NODE_ENV=production npm run build

# Bundle size check
npm run performance:test
```

### Deployment Issues
```javascript
// Process environment check
console.log('Environment:', process.env.NODE_ENV);
console.log('Port:', process.env.PORT);
console.log('MongoDB URI:', process.env.MONGODB_URI ? 'SET' : 'NOT SET');
```

## ğŸ†• Mongoose Populate Errors (2025-02-06) âœ… GÃœNCEL
```javascript
// âŒ Problem: StrictPopulateError: Cannot populate path `departman` because it is not in your schema

// ğŸ“‹ Root Cause Analysis:
// 1. Backend route'unda yanlÄ±ÅŸ field adÄ± kullanÄ±lÄ±yor
// 2. User schema'sÄ±nda field adÄ± farklÄ±
// 3. Frontend'de eski field adÄ± bekleniyor

// âœ… Solution 1: Backend Schema Kontrol
// User.js model'ini kontrol et:
const UserSchema = new mongoose.Schema({
  departmanlar: [{ // 'departman' deÄŸil, 'departmanlar' (array)
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Department',
  }],
});

// âœ… Solution 2: Backend Route DÃ¼zeltmesi
// âŒ HatalÄ± populate:
.populate('departman', 'ad') // Bu field yok

// âœ… DoÄŸru populate:
.populate('departmanlar', 'ad') // Schema'daki gerÃ§ek field

// âœ… Solution 3: Query Condition DÃ¼zeltmesi
// âŒ HatalÄ± query field:
const users = await User.find({ aktif: true }); // 'aktif' field yok

// âœ… DoÄŸru query field:
const users = await User.find({ durum: 'aktif' }); // Schema'daki gerÃ§ek field

// âœ… Solution 4: Frontend Data Mapping
// Backend'den dÃ¶nen veri yapÄ±sÄ±:
personData = {
  departmanlar: ['Ãœretim', 'Kalite'], // Array of strings
  guncellemeTarihi: '2025-02-06',
  roller: ['Usta', 'Kalite Kontrol'],
};

// âœ… Frontend'de kullanÄ±m:
{person.departmanlar?.join(', ') || 'AtanmamÄ±ÅŸ'}
{person.guncellemeTarihi ? new Date(person.guncellemeTarihi).toLocaleDateString('tr-TR') : 'N/A'}

// âœ… Solution 5: Populate Strategy
// Ã‡oklu populate:
.populate('roller', 'ad')
.populate('departmanlar', 'ad')
.populate('secilenMakinalar', 'envanterKodu ad kategori')

// âœ… Solution 6: Schema Field Verification Script
const verifySchema = async () => {
  const User = require('./models/User');
  console.log('User schema fields:', Object.keys(User.schema.paths));
  // Output: ['ad', 'soyad', 'roller', 'departmanlar', 'secilenMakinalar', ...]
};

// âœ… Solution 7: Error Prevention Pattern
// Populate Ã¶ncesi field varlÄ±ÄŸÄ± kontrol:
const populateFields = [];
if (User.schema.paths.departmanlar) {
  populateFields.push({ path: 'departmanlar', select: 'ad' });
}
if (User.schema.paths.roller) {
  populateFields.push({ path: 'roller', select: 'ad' });
}

const users = await User.find(query).populate(populateFields);
```

## ğŸ†• Array vs Single Field Schema Mismatches (2025-02-06)
```javascript
// âŒ Common Schema/Code Mismatch:

// Schema definition:
departmanlar: [{ type: ObjectId, ref: 'Department' }] // Array field

// Backend route (wrong):
.populate('departman', 'ad') // Single field name

// Frontend expectation (wrong):
{person.departman} // Single field access

// âœ… Correct Full Stack Implementation:

// 1. Schema (User.js):
departmanlar: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Department' }]

// 2. Backend populate (personnel-tracking.js):
.populate('departmanlar', 'ad')

// 3. Backend data mapping:
const personData = {
  departmanlar: person.departmanlar?.map(d => d.ad) || ['AtanmamÄ±ÅŸ'],
};

// 4. Frontend display:
{person.departmanlar?.join(', ') || 'AtanmamÄ±ÅŸ'}

// âœ… Multi-Department Support Pattern:
// Backend grouping strategy:
departmanAdlari.forEach(deptAd => {
  if (!departmentPersonnel[deptAd]) {
    departmentPersonnel[deptAd] = [];
  }
  departmentPersonnel[deptAd].push(personData);
});

// Frontend chip display:
{person.departmanlar?.map((dept, index) => (
  <Chip key={index} label={dept} size="small" />
))}
```

## ğŸš¨ GÃœNCEL SORUN Ã‡Ã–ZÃœMLERÄ° (2025-02-06)

### ğŸ”§ Inventory Field Templates Debug SÃ¼reci âœ…

#### Problem TanÄ±mÄ±
```bash
# SORUN: Frontend'de field templates gÃ¶rÃ¼nmÃ¼yor (categoryFieldTemplates: 0)
# Backend'de 25 template var ama frontend'e ulaÅŸmÄ±yor

# Console Log Pattern:
useInventoryData.js:45 ğŸ”„ Categories API Ã§aÄŸrÄ±lÄ±yor...
useInventoryData.js:47 âœ… Categories API yanÄ±t: 3 kategori
useInventoryData.js:83 ğŸ”„ Items API Ã§aÄŸrÄ±lÄ±yor...
useInventoryData.js:85 âœ… Items API yanÄ±t: 13 item
Inventory.js:121 ğŸ”§ Field templates yÃ¼kleniyor, categoryId: 68380aa8b945226655fd3a9b
ItemDynamicFields.js:186 categoryFieldTemplates: 0 âŒ SORUN BURADA!
```

#### Debug Methodology âœ…
```javascript
// âœ… 1. BACKEND VERÄ°FÄ°CATION - Database test script
const testFieldTemplates = async () => {
  try {
    await connectDB();
    
    const categoryId = '68380aa8b945226655fd3a9b';
    const templates = await InventoryFieldTemplate.find({kategoriId: categoryId});
    
    console.log(`ğŸ“Š Kategori ${categoryId} iÃ§in ${templates.length} template bulundu:`);
    
    templates.forEach((template, index) => {
      console.log(`${index + 1}. ${template.alanAdi} (${template.alanTipi})`);
      console.log(`   Zorunlu: ${template.zorunlu}`);
      console.log(`   Grup: ${template.grup || 'BelirtilmemiÅŸ'}`);
    });
  } catch (error) {
    console.error('âŒ Test error:', error);
  }
};

// SonuÃ§: âœ… 25 template confirmed in database
```

```javascript
// âœ… 2. API ENDPOINT VERÄ°FÄ°CATION
// Problem: GET /api/inventory/categories/:id/fields 404 Not Found
// Ã‡Ã¶zÃ¼m: Eksik endpoint eklendi

router.get('/categories/:id/fields', auth, checkModulePermission('Envanter YÃ¶netimi'), async (req, res) => {
  try {
    console.log('ğŸ” Field templates request for categoryId:', req.params.id);
    
    const templates = await InventoryFieldTemplate.find({kategoriId: req.params.id}).sort({siraNo: 1});
    console.log(`ğŸ“Š Found ${templates.length} templates`);
    
    // âœ… Critical: Field mapping (database â†’ frontend)
    const mappedTemplates = templates.map((template) => ({
      _id: template._id,
      kategoriId: template.kategoriId,
      alan: template.alanAdi,        // alanAdi â†’ alan (backward compatibility)
      ad: template.alanAdi,          // alanAdi â†’ ad (frontend expected)
      tip: template.alanTipi,        // alanTipi â†’ tip (frontend expected)
      gerekli: template.zorunlu,     // zorunlu â†’ gerekli (frontend expected)
      siraNo: template.siraNo,
      grup: template.grup,
      varsayilanDeger: template.varsayilanDeger,
      secenekler: template.secenekler,
      aciklama: template.aciklama,
      aktif: template.aktif
    }));
    
    res.json(mappedTemplates);
  } catch (error) {
    console.error('âŒ Field templates error:', error);
    res.status(500).json({ 
      message: 'Field templates loading error',
      error: error.message 
    });
  }
});
```

```javascript
// âœ… 3. FRONTEND API CALL VERÄ°FÄ°CATION
// Problem: loadFieldTemplates function Ã§aÄŸrÄ±lmÄ±yor
// Debug strategy: Comprehensive logging

const loadFieldTemplates = useCallback(async (categoryId) => {
  console.log('ğŸš€ ENTERED loadFieldTemplates function with categoryId:', categoryId);
  console.log('ğŸ” CategoryId type:', typeof categoryId);
  console.log('ğŸ” CategoryId value:', categoryId);
  
  if (!categoryId) {
    console.log('âŒ No categoryId provided to loadFieldTemplates');
    setFieldTemplates([]);
    return;
  }

  try {
    console.log('ğŸ”§ Loading field templates for categoryId:', categoryId);
    console.log('ğŸŒ Making API call to:', `/api/inventory/categories/${categoryId}/fields`);
    
    const response = await inventoryAPI.getCategoryFields(categoryId);
    
    console.log('âœ… Field templates response received');
    console.log('ğŸ“Š Response status:', response.status);
    console.log('ğŸ“¦ Response data:', response.data);
    console.log('ğŸ”¢ Templates count:', response.data?.length || 0);
    
    if (response.data && response.data.length > 0) {
      console.log('âœ… Field templates baÅŸarÄ±yla yÃ¼klendi:', response.data.length);
      setFieldTemplates(response.data);
    } else {
      console.log('âš ï¸ Field templates boÅŸ veya yok');
      setFieldTemplates([]);
    }
  } catch (error) {
    console.error('âŒ Field template yÃ¼kleme hatasÄ±:', error);
    setFieldTemplates([]);
  }
}, []);
```

```javascript
// âœ… 4. COMPONENT DEBUG PATTERN
// Problem: useItemForm hook'unda categoryFieldTemplates boÅŸ kalÄ±yor
// Root cause: fieldTemplates prop boÅŸ geliyor

// Debug strategy:
const handleItemEdit = async (item) => {
  console.log('ğŸ¯ handleItemEdit called with item:', item);
  
  try {
    setSelectedItem(item);
    
    if (item.kategoriId) {
      const categoryId = typeof item.kategoriId === 'object' 
        ? item.kategoriId._id 
        : item.kategoriId;
        
      console.log('ğŸ”§ Field templates yÃ¼kleniyor, categoryId:', categoryId);
      console.log('ğŸ” loadFieldTemplates function type:', typeof loadFieldTemplates);
      console.log('â³ About to call loadFieldTemplates...');
      
      await loadFieldTemplates(categoryId);
      
      console.log('âœ… loadFieldTemplates completed successfully');
    }
    
    setItemDialog(true);
  } catch (error) {
    console.error('âŒ handleItemEdit error:', error);
  }
};
```

#### Debug Log Patterns âœ…
```javascript
// âœ… SUCCESSFUL DEBUG LOG SEQUENCE (After fix):
// ğŸ”„ Categories API Ã§aÄŸrÄ±lÄ±yor...
// âœ… Categories API yanÄ±t: 3 kategori
// ğŸ”„ Items API Ã§aÄŸrÄ±lÄ±yor...
// âœ… Items API yanÄ±t: 13 item
// ğŸ¯ handleItemEdit called with item: {kategoriId: "68380aa8b945226655fd3a9b", ...}
// ğŸ”§ Field templates yÃ¼kleniyor, categoryId: 68380aa8b945226655fd3a9b
// ğŸš€ ENTERED loadFieldTemplates function with categoryId: 68380aa8b945226655fd3a9b
// ğŸ” CategoryId type: string
// ğŸŒ Making API call to: /api/inventory/categories/68380aa8b945226655fd3a9b/fields
// âœ… Field templates response received
// ğŸ“¦ Response data: [25 template objects]
// ğŸ”¢ Templates count: 25
// âœ… Field templates baÅŸarÄ±yla yÃ¼klendi: 25
// ğŸ” ItemDynamicFields Debug: categoryFieldTemplates: 25 âœ… Ã‡Ã–ZÃœLDÃœ!
```

### ğŸ› MyActivity API Debug Patterns âœ…

#### Task Details Multi-Type Error Handling
```javascript
// âœ… Enhanced error handling for task details
const debugTaskDetails = async (taskId) => {
  console.log(`ğŸ” Task details debugging for ID: ${taskId}`);
  
  // Type detection
  if (taskId.startsWith('hr_checklist_')) {
    console.log('ğŸ“‹ Detected: HR Checklist evaluation');
  } else if (taskId.startsWith('hr_mesai_')) {
    console.log('â° Detected: HR Mesai evaluation');
  } else if (taskId.startsWith('hr_devamsizlik_')) {
    console.log('ğŸ“… Detected: HR DevamsÄ±zlÄ±k evaluation');
  } else if (taskId.length === 24 && !taskId.startsWith('hr_')) {
    console.log('ğŸ†” Detected: MongoDB ObjectId (Task/WorkTask/QualityControl)');
    
    // Try WorkTask first
    const workTask = await WorkTask.findById(taskId);
    if (workTask) {
      console.log('âœ… Found WorkTask:', workTask.checklist?.ad);
      return 'worktask';
    }
    
    // Then Quality Control
    const qualityEvaluation = await QualityControlEvaluation.findById(taskId);
    if (qualityEvaluation) {
      console.log('âœ… Found Quality Control evaluation');
      return 'quality_control';
    }
    
    // Finally normal Task
    const task = await Task.findById(taskId);
    if (task) {
      console.log('âœ… Found normal Task:', task.checklist?.ad);
      return 'task';
    }
    
    console.log('âŒ No matching document found for ID');
    return null;
  } else {
    console.log('â“ Unknown ID format');
    return null;
  }
};
```

### ğŸ”§ Component Debug Utilities âœ…

#### React Hook Debug Pattern
```javascript
// âœ… useCallback dependency debug
const useDebugCallback = (callback, dependencies, name) => {
  const [prevDeps, setPrevDeps] = useState(dependencies);
  
  const memoizedCallback = useCallback((...args) => {
    console.log(`ğŸ”„ ${name} callback triggered with args:`, args);
    return callback(...args);
  }, dependencies);
  
  useEffect(() => {
    if (prevDeps) {
      dependencies.forEach((dep, index) => {
        if (dep !== prevDeps[index]) {
          console.log(`ğŸ”„ ${name} dependency ${index} changed:`, {
            from: prevDeps[index],
            to: dep
          });
        }
      });
    }
    setPrevDeps(dependencies);
  }, dependencies);
  
  return memoizedCallback;
};

// Usage:
const loadFieldTemplates = useDebugCallback(async (categoryId) => {
  // Callback logic
}, [inventoryAPI], 'loadFieldTemplates');
```

#### API Response Debug Helper
```javascript
// âœ… API response validation and debug
const debugAPIResponse = (response, expectedFields = []) => {
  console.log('ğŸ“¡ API Response Debug:');
  console.log('  Status:', response.status);
  console.log('  Data type:', typeof response.data);
  console.log('  Data length:', Array.isArray(response.data) ? response.data.length : 'Not array');
  
  if (Array.isArray(response.data) && response.data.length > 0) {
    const firstItem = response.data[0];
    console.log('  First item keys:', Object.keys(firstItem));
    
    expectedFields.forEach(field => {
      if (firstItem.hasOwnProperty(field)) {
        console.log(`  âœ… Has expected field: ${field}`);
      } else {
        console.log(`  âŒ Missing expected field: ${field}`);
      }
    });
  }
  
  return response;
};

// Usage:
const response = await inventoryAPI.getCategoryFields(categoryId);
debugAPIResponse(response, ['ad', 'tip', 'gerekli', 'siraNo']);
```

#### State Change Debug Pattern
```javascript
// âœ… State change tracker
const useStateDebug = (stateName, state) => {
  const prevState = useRef(state);
  
  useEffect(() => {
    if (prevState.current !== state) {
      console.log(`ğŸ”„ ${stateName} changed:`, {
        from: prevState.current,
        to: state,
        type: typeof state,
        length: Array.isArray(state) ? state.length : undefined
      });
      prevState.current = state;
    }
  }, [state, stateName]);
};

// Usage:
useStateDebug('fieldTemplates', fieldTemplates);
useStateDebug('categoryFieldTemplates', categoryFieldTemplates);
```

### ğŸ” Database Query Debug Utilities âœ…

#### Query Performance Tracker
```javascript
// âœ… Database query debug wrapper
const debugQuery = async (queryName, queryPromise) => {
  const startTime = Date.now();
  console.log(`ğŸ” Query started: ${queryName}`);
  
  try {
    const result = await queryPromise;
    const duration = Date.now() - startTime;
    
    console.log(`âœ… Query completed: ${queryName}`, {
      duration: `${duration}ms`,
      resultCount: Array.isArray(result) ? result.length : 'single',
      resultType: typeof result
    });
    
    if (duration > 100) {
      console.warn(`âš ï¸ Slow query detected: ${queryName} took ${duration}ms`);
    }
    
    return result;
  } catch (error) {
    const duration = Date.now() - startTime;
    console.error(`âŒ Query failed: ${queryName} after ${duration}ms`, error);
    throw error;
  }
};

// Usage:
const templates = await debugQuery(
  'InventoryFieldTemplate.find',
  InventoryFieldTemplate.find({kategoriId: categoryId}).sort({siraNo: 1})
);
```

### ğŸ”§ Network Debug Utilities âœ…

#### Request Interceptor Debug
```javascript
// âœ… Enhanced request/response interceptor
api.interceptors.request.use(
  (config) => {
    console.log(`ğŸŒ API Request: ${config.method?.toUpperCase()} ${config.url}`, {
      params: config.params,
      data: config.data,
      headers: Object.keys(config.headers || {}),
      timestamp: new Date().toISOString()
    });
    return config;
  },
  (error) => {
    console.error('âŒ API Request Error:', error);
    return Promise.reject(error);
  }
);

api.interceptors.response.use(
  (response) => {
    const responseSize = JSON.stringify(response.data).length;
    console.log(`ğŸ“¥ API Response: ${response.status} ${response.config.url}`, {
      dataType: typeof response.data,
      dataLength: Array.isArray(response.data) ? response.data.length : undefined,
      responseSize: `${responseSize} bytes`,
      timestamp: new Date().toISOString()
    });
    return response;
  },
  (error) => {
    console.error('âŒ API Response Error:', {
      status: error.response?.status,
      statusText: error.response?.statusText,
      url: error.config?.url,
      message: error.message
    });
    return Promise.reject(error);
  }
);
```

### ğŸ“Š Memory Debug Utilities âœ…

#### Memory Leak Detection
```javascript
// âœ… Memory usage tracker for debugging
const useMemoryDebug = (componentName) => {
  useEffect(() => {
    if (performance.memory) {
      const memoryInfo = {
        used: Math.round(performance.memory.usedJSHeapSize / 1048576),
        total: Math.round(performance.memory.totalJSHeapSize / 1048576),
        limit: Math.round(performance.memory.jsHeapSizeLimit / 1048576)
      };
      
      console.log(`ğŸ’¾ ${componentName} memory usage:`, memoryInfo);
      
      if (memoryInfo.used > memoryInfo.limit * 0.9) {
        console.warn(`âš ï¸ ${componentName} high memory usage detected!`);
      }
    }
  }, [componentName]);
};

// Usage in components:
useMemoryDebug('Inventory');
```

## ğŸ”§ Port Conflict Resolution (Updated 2025-02-06)

### Backend Port DeÄŸiÅŸtirme & Cache Temizleme
```javascript
// server.js
const PORT = process.env.PORT || 5001; // 5000 yerine 5001 kullan

// frontend/package.json
"proxy": "http://localhost:5001"
```

### Port Ã‡akÄ±ÅŸmasÄ± KontrolÃ¼
```bash
# Windows'ta port kontrolÃ¼
netstat -ano | findstr :5000
tasklist /FI "PID eq 5000" /FO TABLE

# Port'u serbest bÄ±rakma
taskkill /PID [PID_NUMBER] /F

# Nodemon cache temizleme
rm -rf node_modules/.cache
npx nodemon --clean
```

### Nodemon Cache SorunlarÄ±
```bash
# Nodemon restart'Ä± zorla
rs  # Nodemon console'da

# Cache temizleme
rm -rf backend/node_modules/.cache
rm -rf backend/.nodemonignore.cache

# Environment variable override kontrolÃ¼
echo $PORT  # Linux/Mac
echo %PORT%  # Windows

# .env dosyasÄ± kontrol et
cat backend/.env | grep PORT
```

### Environment Variable Priority
```bash
# Ã–ncelik sÄ±rasÄ±:
# 1. System environment variables
# 2. .env dosyasÄ±
# 3. Default value (kod iÃ§inde)

# .env dosyasÄ±nÄ± override etme
PORT=5001 npm run start:backend
```

### Backend Port DeÄŸiÅŸtirme & Cache Temizleme
```javascript
// server.js
const PORT = process.env.PORT || 5001; // 5000 yerine 5001 kullan

// frontend/package.json
"proxy": "http://localhost:5001"
```

### Port Ã‡akÄ±ÅŸmasÄ± KontrolÃ¼
```bash
# Windows'ta port kontrolÃ¼
netstat -ano | findstr :5000
tasklist /FI "PID eq 5000" /FO TABLE

# Port'u serbest bÄ±rakma
taskkill /PID [PID_NUMBER] /F

# Nodemon cache temizleme
rm -rf node_modules/.cache
npx nodemon --clean
```

### Nodemon Cache SorunlarÄ±
```bash
# Nodemon restart'Ä± zorla
rs  # Nodemon console'da

# Cache temizleme
rm -rf backend/node_modules/.cache
rm -rf backend/.nodemonignore.cache

# Environment variable override kontrolÃ¼
echo $PORT  # Linux/Mac
echo %PORT%  # Windows

# .env dosyasÄ± kontrol et
cat backend/.env | grep PORT
```

### Environment Variable Priority
```bash
# Ã–ncelik sÄ±rasÄ±:
# 1. System environment variables
# 2. .env dosyasÄ±
# 3. Default value (kod iÃ§inde)

# .env dosyasÄ±nÄ± override etme
PORT=5001 npm run start:backend
```

---

**Quick Reference**: Bu modÃ¼l development sÄ±rasÄ±nda karÅŸÄ±laÅŸÄ±lan tÃ¼m teknik sorunlarÄ± Ã§Ã¶zmek iÃ§in hazÄ±rlanmÄ±ÅŸtÄ±r. Her hata mesajÄ± iÃ§in hÄ±zlÄ± Ã§Ã¶zÃ¼m adÄ±mlarÄ± iÃ§erir.








